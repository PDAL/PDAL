
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Batch Processing &mdash; pdal.io</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/pdal.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/breathe.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="canonical" href="https://pdal.io/workshop/exercises/batch_processing/batch-processing.html"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="Final Project" href="../../capstone.html" />
    <link rel="prev" title="Georeferencing" href="../georeferencing/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
          </a>
              <div class="version">
                2.6.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../download.html">Download</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../apps/index.html">Applications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../community.html">Community</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pipeline.html">Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../stages/stages.html">Stages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../stages/readers.html">Readers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../stages/writers.html">Writers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../stages/filters.html">Filters</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../dimensions.html">Dimensions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../types.html">Types</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../python.html">Python</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../java.html">Java</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html">Tutorials</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Workshop</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../agenda.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lidar-introduction.html">Introduction to LiDAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software.html">Software Installation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Exercises</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../index.html#basic-information">Basic Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#translation">Translation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#analysis">Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#python">Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#georeferencing">Georeferencing</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#batch-processing">Batch Processing</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Batch Processing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../capstone.html">Final Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notes.html">Notes</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project/index.html">Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../copyright.html">License</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PDAL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html"> Documentation </a> &raquo;</li>
      
          <li><a href="../../index.html">Point Cloud Processing and Analysis with PDAL</a> &raquo;</li>
      
          <li><a href="../index.html">Exercises</a> &raquo;</li>
      
      <li>Batch Processing</li>
    

    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/PDAL/PDAL/edit//master/doc/workshop/exercises/batch_processing/batch-processing.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="../../capstone.html" class="btn btn-neutral float-right" title="Final Project" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../georeferencing/index.html" class="btn btn-neutral float-left" title="Georeferencing" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="batch-processing">
<span id="workshop-batch-processing"></span><h1>Batch Processing<a class="headerlink" href="#batch-processing" title="Permalink to this heading"></a></h1>
<p>PDAL doesn’t handle matching multiple file inputs except for glob handling for merge operations,
but does allow for command line substitution parameters to make batch processing simpler,
substitutions. Substitutions work with both <a class="reference internal" href="../../../pipeline.html#pipeline"><span class="std std-ref">Pipeline</span></a> operations as well as with
other applications such as <a class="reference internal" href="../../../apps/translate.html#translate-command"><span class="std std-ref">translate</span></a>.</p>
<section id="operating-system-variations">
<h2>Operating system variations<a class="headerlink" href="#operating-system-variations" title="Permalink to this heading"></a></h2>
<p>How substitutions are passed generally depends on the operating system and tools available.
In the unix/linux environments, this is primarily using the <cite>find</cite> and <cite>ls</cite> programs to get
lists of files (either with directories or just filenames) and the <cite>xargs</cite> or <cite>parallel</cite> program to pass
those files to the <code class="docutils literal notranslate"><span class="pre">pdal</span></code> application (although <cite>-exec</cite> with <cite>find</cite> can also be used). These
tools are available in the <cite>docker</cite> environment if you are running <cite>PDAL</cite> under docker. They
are also available under Windows one installs <cite>Cygwin</cite> or <cite>MinGW</cite>. They are also available if
Git for Windows is installed. They are also available as win32 command line programs installed
from the GNU Findutils (<a class="reference external" href="https://www.gnu.org/software/findutils/findutils.html">https://www.gnu.org/software/findutils/findutils.html</a>). They are
available for MacOS and Linux.</p>
</section>
<section id="windows-native-tools">
<h2>Windows native tools<a class="headerlink" href="#windows-native-tools" title="Permalink to this heading"></a></h2>
<p>Subtitions can be handled directly in windows using <cite>PowerShell</cite> syntax.</p>
<p>While there are a number of ways to generate lists of files, the <cite>Get-ChildItem</cite> is used here,
along with the <cite>foreach</cite> option to pass each separate filepath to the pdal application.</p>
</section>
<section id="example-batch-compression-of-las-files-to-laz-powershell">
<h2>Example - Batch compression of LAS files to LAZ - PowerShell:<a class="headerlink" href="#example-batch-compression-of-las-files-to-laz-powershell" title="Permalink to this heading"></a></h2>
<p>To compress a series of LAS files in one directory into compressed LAZ files in another
directory, the <cite>PowerShell</cite> syntax would be:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-ChildItem</span> <span class="p">.\</span><span class="n">DIR1</span><span class="p">\*.</span><span class="n">las</span> <span class="p">|</span> <span class="k">foreach</span> <span class="p">{</span><span class="n">pdal</span> <span class="n">translate</span> <span class="n">-i</span> <span class="p">.\</span><span class="n">DIR1</span><span class="p">\$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">BaseName</span><span class="p">).</span><span class="n">las</span> <span class="p">^</span>
<span class="n">-o</span> <span class="p">.\</span><span class="n">DIR2</span><span class="p">\$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">BaseName</span><span class="p">).</span><span class="n">laz</span><span class="p">}</span>
</pre></div>
</div>
<p>Note the use of the <cite>$($_.BaseName)</cite> syntax for the files passed. This option on the <cite>$($_)</cite> shortcut for
the full filename, removes the directory and the extension on the file and allows the user to set
the path and extension manually.</p>
</section>
<section id="example-parallel-batch-compression-of-las-files-to-laz-powershell">
<h2>Example - Parallel Batch compression of LAS files to LAZ - PowerShell:<a class="headerlink" href="#example-parallel-batch-compression-of-las-files-to-laz-powershell" title="Permalink to this heading"></a></h2>
<p>This use of the <cite>PowerShell</cite> syntax doesn’t allow a user to execute more than one process at a
time. There is a free download of the <cite>xargs</cite> program that provides parallel execution available
at <a class="reference external" href="http://www.pirosa.co.uk/demo/wxargs/ppx2.exe">http://www.pirosa.co.uk/demo/wxargs/ppx2.exe</a>. For this tool, the file names are passed with
using the <cite>{}</cite> syntax.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-ChildItem</span> <span class="p">.\</span><span class="n">dir1</span><span class="p">\</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-ExpandProperty</span> <span class="n">BaseName</span> <span class="p">^</span>
<span class="p">|</span> <span class="p">.\</span><span class="n">ppx2</span><span class="p">.</span><span class="n">exe</span> <span class="n">-P</span> <span class="n">3</span> <span class="n">pdal</span> <span class="n">translate</span> <span class="n">-i</span> <span class="s2">&quot;.\dir1\{}.las&quot;</span> <span class="n">-o</span> <span class="s2">&quot;.\dir2\{}.laz&quot;</span>
</pre></div>
</div>
</section>
<section id="example-batch-compression-of-las-files-to-laz-bash">
<h2>Example - Batch compression of LAS files to LAZ - Bash:<a class="headerlink" href="#example-batch-compression-of-las-files-to-laz-bash" title="Permalink to this heading"></a></h2>
<p>To compress a series of LAS files in one directory into compressed LAZ files in another
directory, the <cite>Bash</cite> syntax would be:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ls ./dir1/*.las | parallel -I{} \</span>
<span class="go">pdal translate -i ./dir1/{/.}.las -o ./dir2/{/.}.laz</span>
</pre></div>
</div>
<p>In <cite>Parallel</cite>, then  <cite>{/.}</cite> syntax means strip the directory and the extension and just use the
basename of the file. This allows you to easily change the output format and the location.</p>
</section>
<section id="example-parallel-batch-compression-of-las-files-to-laz-bash">
<h2>Example - Parallel Batch compression of LAS files to LAZ - Bash:<a class="headerlink" href="#example-parallel-batch-compression-of-las-files-to-laz-bash" title="Permalink to this heading"></a></h2>
<p>Parallel, as its name implies, allows parallel operations. Adding the <cite>-j</cite> syntax indicates the number simultaneous
jobs to run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ls ./dir1/*.las | parallel -I{} -j 4 \</span>
<span class="go">pdal translate -i ./dir1/{/.}.las -o ./dir2/{/.}.laz</span>
</pre></div>
</div>
</section>
<section id="exercise-pipeline-substitions">
<h2>Exercise - Pipeline Substitions:<a class="headerlink" href="#exercise-pipeline-substitions" title="Permalink to this heading"></a></h2>
<p>For the most flexibility, pipelines are used to apply a series of operations to a file (or group
of files). In this exercise, we build on the <a class="reference internal" href="../analysis/dtm/dtm.html#workshop-dtm"><span class="std std-ref">Generating a DTM</span></a> pipeline example, but run this pipeline over 4 files and
reproject, calculate a bare earth using the <a class="reference internal" href="../../../stages/filters.smrf.html#filters-smrf"><span class="std std-ref">filters.smrf</span></a> filter, remove those points that aren’t bare earth
with <a class="reference internal" href="../../../stages/filters.range.html#filters-range"><span class="std std-ref">filters.range</span></a> and then write the output using the <a class="reference internal" href="../../../stages/writers.gdal.html#writers-gdal"><span class="std std-ref">writers.gdal</span></a>.</p>
<p>The pipeline we are using is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;pipeline&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;readers.las&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;filters.reprojection&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>  
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;filters.smrf&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;filters.range&quot;</span><span class="p">,</span>
            <span class="s2">&quot;limits&quot;</span><span class="p">:</span><span class="s2">&quot;Classification[2:2]&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;gdaldriver&quot;</span><span class="p">:</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
            <span class="s2">&quot;output_type&quot;</span><span class="p">:</span><span class="s2">&quot;idw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resolution&quot;</span> <span class="p">:</span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;writers.gdal&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You might have spotted that this pipeline doesn’t have any input or output file references, or a value for the
output spatial reference. We will be adding those at the command line, not within the actual pipeline and
using the substitutions syntax to do this.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">PS ./exercises/batch&gt; Get-ChildItem  ./exercises/batch/source/*.laz | ^</span>
<span class="go">foreach {pdal pipeline ./exercises/batch/batch_srs_gdal.json ^</span>
<span class="go">--readers.las.filename=./source/$($_.BaseName).laz ^</span>
<span class="go">--writers.gdal.filename=./dtm/$($_.BaseName).tif ^</span>
<span class="go">--filters.reprojection.in_srs=epsg:3794 ^</span>
<span class="go">--filters.reprojection.in_srs=epsg:32733}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ls ./exercises/batch_processing/source/*.laz | \</span>
<span class="go">parallel -I{} pdal pipeline ./exercises/batch_processing/batch_srs_gdal.json \</span>
<span class="go"> --readers.las.filename={} \</span>
<span class="go"> --writers.gdal.filename=./exercises/batch_processing/dtm{/.}.tif \</span>
<span class="go"> --filters.reprojection.in_srs=epsg:3794 \</span>
<span class="go"> --filters.reprojection.out_srs=epsg:32733</span>
</pre></div>
</div>
</div></blockquote>
<p>Once you have your dtms created with pdal, combine them to a single file with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">gdalbuildvrt  ./exercises/batch_processing/dtm.vrt ./exercises/batch_processing/dtm*.tif</span>
</pre></div>
</div>
<p>You can then visualize the vrt with <cite>qgis</cite>. Add the vrt twice, and set the properties of the lower
layer to hillshade. Set the upper layer to Singleband PseudoColor and choose a pleasing color ramp.
Then set the transparency of the upper layer to 50% and you’ll get a nice display of the terrain.</p>
<a class="reference external image-reference" href="../../../_images/batch-processing-dtm-qgis.png"><img alt="../../../_images/batch-processing-dtm-qgis.png" src="../../../_images/batch-processing-dtm-qgis.png" /></a>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../capstone.html" class="btn btn-neutral float-right" title="Final Project" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../georeferencing/index.html" class="btn btn-neutral float-left" title="Georeferencing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <div class="info">
      <a class="logo-link" href="https://hobu.co">
        <div class="hobu-logo"></div>
      </a>
      <div class="copyright">
      

                    &copy;  2023
                        <a href="https://github.com/abellgithub">Andrew Bell</a>,
                        <a href="https://github.com/chambbj">Brad Chambers</a>,
                        <a href="http://github.com/hobu">Howard Butler</a>,
                        and
                        <a href="https://github.com/PDAL/PDAL/graphs/contributors">others</a>.

      
      Last updated on May 22, 2023.
      </div>
    </div>
</footer>
        </div>
      </div>
    </section>
  </div>
  
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <div class="footer">
        <div class="container">
                    &copy;  2023
                        <a href="http://github.com/hobu">Howard Butler</a>,
                        <a href="http://github.com/mpgerlek">Michael Gerlek</a>,
                        and
                        <a href="https://github.com/PDAL/PDAL/graphs/contributors">others</a>,
                Last updated
                    on May 22, 2023.
        </div>
    </div>

</body>
</html>